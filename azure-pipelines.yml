# Starter pipeline
# Start with a minimal pipeline that you can customize to build and deploy your code.
# Add steps that build, run tests, deploy, and more:
# https://aka.ms/yaml

parameters:
- name: browser
  type: string
  default: chromium
  values:
    - chromium
    - firefox
    - webkit


trigger:
- main

pool:
  name: self-hosted-agent

steps:
- script: python -m pip install --upgrade pip
  displayName: 'Installing pip'

- script: |
    pip install -r requirements.txt
  displayName: 'Installing Requirements'
  condition: succeededOrFailed()

- script: pytest --browser ${{ parameters.browser }} --junitxml="./reports/e2e-result.xml"
  displayName: 'Running Tests'
  condition: succeededOrFailed()
  
- task: PublishTestResults@2
  displayName: 'Publish test results'
  inputs:
    testResultsFiles: 'reports/e2e-result.xml'
    testResultsFormat: 'JUnit'
    testRunTitle: 'Publish Playwright Pytest Results'
    failTaskOnFailedTests: true
  condition: succeededOrFailed()